<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TINAC Example</title>
    <style>
        body {
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: Arial, sans-serif;

        }
        input[type="text"] {
            width: 400px;
            padding: 8px;
            height: 36px;
            margin: 8px 0;
            box-sizing: border-box;
            background-color: #2d2d2d;
            color: #d4d4d4;
            border: 1px solid #555;
        }
        button {
            background-color: #007acc;
            color: white;
            height: 36px;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }

        input[type="range"] {
            width: 400px;
            margin: 8px 0;
        }
        button:hover {
            background-color: #005f99;
        }
        pre {
            font-family: "Courier New", Courier, monospace;
            line-height: 1;
            font-size: 12px;
        }

        
    </style>
</head>
<body>
    <h1>TINAC Captcha example</h1>
    <p>API URL:</p>
    <input type="text" id="api_url" value="http://tanjim.duckdns.org:3456"><button onclick="fetchCaptcha()">Fetch Captcha</button>
    <p>Note: It may take some time to fetch. Wait until you see the captcha below.</p>
    <div id="captcha_container">
        <pre id="captcha_display">Click "Fetch Captcha" to start</pre>
        <p>Slowly drag the slider until you see legible text. Then enter the text you see in the input box below.</p>
        <input type="range" id="captcha_slider" min="0" max="49" value="0" oninput="updateSliderValue()"> <span id="selected_index">0</span>
        <br><input type="text" id="answer_input" placeholder="Enter captcha text here"><button onclick="submitCaptcha()">Submit Captcha</button>
         
    </div>
    
    <div id="result"></div>
    <script>
        function fetchCaptcha() {
            const apiUrl = document.getElementById('api_url').value;
            const captchaDisplay = document.getElementById('captcha_display');
            captchaDisplay.textContent = "Fetching captcha, please wait...";
            fetch(`${apiUrl}/challenge`)
                .then(response => response.json())
                .then(data => {
                    window.captchaId = data.id;
                    window.captchaChallenges = data.challenge;
                    updateCaptchaDisplay(0);
                })
                .catch(error => {
                    captchaDisplay.textContent = "Error fetching captcha: " + error;
                });
        }
        function updateCaptchaDisplay(index) {
            const captchaDisplay = document.getElementById('captcha_display');
            captchaDisplay.textContent = window.captchaChallenges[index];
        }
        function updateSliderValue() {
            const slider = document.getElementById('captcha_slider');
            const selectedIndex = document.getElementById('selected_index');
            selectedIndex.textContent = slider.value;
            updateCaptchaDisplay(slider.value);
        }
        function submitCaptcha() {
            const apiUrl = document.getElementById('api_url').value;
            const answer = document.getElementById('answer_input').value;
            fetch(`${apiUrl}/verify`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id: window.captchaId,
                    answer: answer,
                    index: parseInt(document.getElementById('captcha_slider').value)
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('result');
                resultDiv.textContent = `Answer is  ${data.answer == true ? "correct" : "incorrect"}, Index is ${data.index == true ? "correct" : "incorrect"}. ${data.error ? ("AN ERROR OCCURED! " + data.error) : ""}`;
            });
        }
    </script>
</body>
</html>